<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Drawing Team – Bootstrap 5 + DataTables</title>

  <!-- Auth guard -->
  <script>
    (function () {
      try {
        if (sessionStorage.getItem('auth') !== 'ok') {
          window.location.replace('Login.html');
        }
      } catch (e) {
        window.location.replace('Login.html');
      }
    })();
  </script>

  <!-- CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.8/css/dataTables.bootstrap5.min.css">

  <style>
    /* ---- Sidebar link colors ---- */
    #sidebar .nav-link,
    #sidebar .nav-link i {
      color: #212529; /* bootstrap body color (almost black) */
    }

    /* Active */
    .nav-pills .nav-link.active,
    .nav-pills .nav-link.link-body-emphasis.active {
      background-color:#1C517F;
      color:#fff !important;
    }
    .nav-pills .nav-link.active i,
    .nav-pills .nav-link.link-body-emphasis.active i {
      color:#fff !important;
    }

    /* Hover */
    .nav-pills .nav-link:hover,
    .nav-pills .nav-link.link-body-emphasis:hover {
      background:#e9ecef;
      color:#1C517F;
    }
    .nav-pills .nav-link:hover i,
    .nav-pills .nav-link.link-body-emphasis:hover i {
      color:#1C517F;
    }

    /* Misc */
    .btn-icon{ border:0; background:transparent; } 
    .btn-icon:focus{ box-shadow:none; }

    /* DataTables header filter row look */
    table.dataTable thead tr.filters th { padding:.25rem .5rem; background: var(--bs-tertiary-bg); }
    thead .form-control, thead .form-select { height:30px; padding:.125rem .5rem; font-size:.875rem; }
    .nowrap{ white-space:nowrap; }
  </style>
</head>
<body>
<div class="d-flex">
  <!-- SIDEBAR -->
  <aside id="sidebar" class="d-flex flex-column flex-shrink-0 p-3 bg-body-tertiary"
         style="width:280px; height:100vh; position:sticky; top:0;">
    <a href="#" class="d-flex align-items-center mb-3 link-body-emphasis text-decoration-none">
      <img src="Image/Drawing%20Team%20Logo.png" alt="Logo" width="210" height="75" class="me-2">
    </a>
    <hr>
    <ul class="nav nav-pills flex-column mb-0" id="sidebarTabs" role="tablist">
      <!-- เริ่มต้น Home ให้ active (Bootstrap จะสลับคลาสให้เองเมื่อคลิกแท็บอื่น) -->
      <li class="nav-item"><a class="nav-link active" data-bs-toggle="pill" data-bs-target="#pane-home" role="tab"><i class="bi bi-house me-2"></i>Home</a></li>
      <li class="nav-item"><a class="nav-link link-body-emphasis" data-bs-toggle="pill" data-bs-target="#pane-add" role="tab"><i class="bi bi-file-plus me-2"></i>Add Drawing</a></li>
      <li class="nav-item"><a class="nav-link link-body-emphasis" data-bs-toggle="pill" data-bs-target="#pane-status" role="tab"><i class="bi bi-archive me-2"></i>Drawing Status</a></li>
      <li class="nav-item"><a class="nav-link link-body-emphasis" data-bs-toggle="pill" data-bs-target="#pane-request" role="tab"><i class="bi bi-cart-plus me-2"></i>Drawing Request</a></li>
      <li class="nav-item"><a class="nav-link link-body-emphasis" data-bs-toggle="pill" data-bs-target="#pane-record" role="tab"><i class="bi bi-journal-bookmark me-2"></i>Request Record</a></li>
      <li class="nav-item"><a class="nav-link link-body-emphasis" data-bs-toggle="pill" data-bs-target="#pane-members" role="tab"><i class="bi bi-people me-2"></i>Members</a></li>
    </ul>
  </aside>

  <!-- MAIN -->
  <main class="flex-grow-1">
    <nav class="navbar sticky-top bg-body border-bottom shadow-sm">
      <div class="container-fluid px-3">
        <button class="btn-icon me-2" id="sidebarToggle" type="button" aria-label="Toggle sidebar">
          <i class="bi bi-text-indent-left fs-4"></i>
        </button>
        <span id="pageTitle" class="navbar-brand mb-0 h1">Home</span>

        <!-- User dropdown (View Profile / Logout) -->
        <div class="dropdown ms-auto">
          <a href="#" class="d-flex align-items-center text-decoration-none dropdown-toggle" 
            id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            <img src="https://akaliko-agips.com/web/assets/images/avatar/avatar-fallback.jpg"
                alt="" width="36" height="36" class="rounded-circle me-2">
            <strong class="d-none d-md-inline">Pingpong Akamine</strong>
          </a>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
            <li><a class="dropdown-item" href="#">View Profile</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="#" id="logoutBtn">Logout</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="tab-content p-3">
      <div class="tab-pane fade show active" id="pane-home" role="tabpanel" tabindex="0">
        <p>ยินดีต้อนรับเข้าสู่ระบบ Drawing Team</p>
      </div>

      <div class="tab-pane fade" id="pane-add" role="tabpanel" tabindex="0">
        <!-- form as-is -->
      </div>

      <div class="tab-pane fade" id="pane-status" role="tabpanel" tabindex="0">
        <div class="table-responsive">
          <table id="orders" class="table table-striped table-bordered align-middle w-100">
            <thead>
              <tr>
                <th>WO Number</th><th>Status</th><th>Equipment Type</th>
                <th>Customer</th><th>Brand</th><th>Model</th>
              </tr>
              <tr class="filters"><th></th><th></th><th></th><th></th><th></th><th></th></tr>
            </thead>
            <tbody>
              <tr><td>AKA0110C7F</td><td>Welding</td><td>Truck</td><td>Akaliko</td><td>CAT</td><td>785C</td></tr>
              <tr><td>AKA0109C7F</td><td>Assembly</td><td>Truck</td><td>Akaliko</td><td>CAT</td><td>785C</td></tr>
              <tr><td>MAK05240060-2</td><td>Received</td><td>Excavator</td><td>MAK</td><td>CAT</td><td>6040</td></tr>
              <tr><td>KSA0276-2503</td><td>Machining</td><td>Excavator</td><td>KSA</td><td>CAT</td><td>6030</td></tr>
              <tr><td>WARLGS0082-3-2506</td><td>Received</td><td>Jack</td><td>LG</td><td>Durapac</td><td>100 tn</td></tr>
              <tr><td>WA0772-2501</td><td>Honing</td><td>Loader</td><td>WA</td><td>SEM</td><td>655D</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="tab-pane fade" id="pane-request" role="tabpanel" tabindex="0"><p>รายการคำขอใหม่จะแสดงที่นี่…</p></div>
      <div class="tab-pane fade" id="pane-record" role="tabpanel" tabindex="0"><p>ประวัติคำขอ…</p></div>

      <div class="tab-pane fade" id="pane-members" role="tabpanel" tabindex="0">
        <ul class="list-group list-group-flush">
          <li class="list-group-item d-flex align-items-center"><i class="bi bi-person-circle me-2"></i> Pingpong Akamine — Planner</li>
          <li class="list-group-item d-flex align-items-center"><i class="bi bi-person-circle me-2"></i> MDO — Supervisor</li>
        </ul>
      </div>
    </div>
  </main>
</div>

<!-- JS -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.8/js/dataTables.bootstrap5.min.js"></script>

<script>
  // Sidebar toggle
  document.getElementById('sidebarToggle').addEventListener('click', () => {
    document.getElementById('sidebar').classList.toggle('d-none');
  });

  // Update page title when tab changes
  const pageTitle = document.getElementById('pageTitle');
  document.querySelectorAll('#sidebarTabs .nav-link').forEach(link => {
    link.addEventListener('shown.bs.tab', (e) => {
      pageTitle.textContent = e.target.textContent.trim();
    });
  });

  // Product type switch
  const productTypeSwitch = document.getElementById('productTypeSwitch');
  const productInput = document.getElementById('productInput');
  if (productTypeSwitch) {
    productTypeSwitch.addEventListener('change', function() {
      if (this.checked) { productInput.disabled = false; productInput.placeholder = 'Single Parts'; }
      else { productInput.disabled = true; productInput.placeholder = 'Cylinder GP'; productInput.value = ''; }
    });
  }

  // DataTables (lazy init)
  let ordersDT = null;
  function initOrdersDataTable(){
    if (ordersDT) return;
    ordersDT = $('#orders').DataTable({
      pageLength: 10,
      orderCellsTop: true,
      fixedHeader: true,
      language: {
        lengthMenu: "Show _MENU_ entries",
        zeroRecords: "No Data",
        info: "Showing _PAGE_ of _PAGES_",
        infoEmpty: "No Data",
        infoFiltered: "(filtered from  _MAX_ total entries)",
        search: "Search:",
        paginate: { first:"first", last:"last", next:"next", previous:"previous" }
      }
    });

    // Build header filters
    $('#orders thead tr.filters th').each(function (i) {
      const col = ordersDT.column(i);
      const title = $(ordersDT.column(i).header()).text();
      const isSelect = ['Status','Equipment Type','Customer','Brand'].includes(title);

      if (isSelect) {
        const select = $('<select class="form-select form-select-sm"><option value="">All</option></select>')
          .appendTo($(this).empty())
          .on('change', function () {
            const val = $.fn.dataTable.util.escapeRegex($(this).val());
            col.search(val ? '^' + val + '$' : '', true, false).draw();
          });

        col.data().unique().sort().each(function (d) {
          const txt = $('<div>').html(d).text();
          select.append(`<option value="${txt}">${txt}</option>`);
        });
      } else {
        $('<input type="text" class="form-control form-control-sm" placeholder="Search ' + title + '">')
          .appendTo($(this).empty())
          .on('keyup change clear', function () {
            if (col.search() !== this.value) col.search(this.value).draw();
          });
      }
    });
  }
  document.querySelector('[data-bs-target="#pane-status"]').addEventListener('shown.bs.tab', initOrdersDataTable);
  // initOrdersDataTable(); // uncomment if you want table immediately
</script>

<!-- Logout -->
<script>
  (function(){
    const btn = document.getElementById('logoutBtn');
    if(!btn) return;
    btn.addEventListener('click', function(e){
      e.preventDefault();
      try{ sessionStorage.removeItem('auth'); }catch(e){}
      window.location.replace('Login.html');
    });
  })();
</script>

</body>
</html>
